

# User and Group Management Script

This script automates the process of managing users and groups on macOS. It reads user details and group information from text files, creates necessary users and groups, assigns users to specified groups, and grants sudo privileges where applicable. All actions are logged in an `audit.log` file for traceability.

## Features
- Create missing users and groups automatically.
- Assign users to groups and manage sudo privileges.
- Log all actions in the `audit.log` file.
- Auto-generate group IDs and missing groups if not already present.
- Set random passwords for users and store them in `passwords.txt`.
- Recreate users if they already exist.

## Prerequisites
- macOS with `dscl` (Directory Service Command Line utility) installed.
- Basic knowledge of Bash scripting.
- Ensure you have `sudo` privileges to execute the script.
- Create the required `users.txt` and `groups.txt` files.

## Files
1. **users.txt**  
   The `users.txt` file contains the details of users to be created, formatted as:
   ```
   username:full_name:groups:sudo_privilege
   ```
   - `username`: The username of the user to be created.
   - `full_name`: The full name of the user.
   - `groups`: A comma-separated list of groups the user should belong to.
   - `sudo_privilege`: A flag (`yes` or `no`) to indicate whether the user should have sudo privileges.

2. **groups.txt**  
   The `groups.txt` file contains the groups to be created, formatted as:
   ```
   group_name:group_id
   ```
   - `group_name`: The name of the group.
   - `group_id`: The unique group ID (optional, will be autogenerated if missing).

3. **audit.log**  
   This file logs all actions performed by the script, such as user and group creation, password assignment, and errors.

4. **passwords.txt**  
   This file stores the randomly generated passwords for users.

## How to Use

### Step 1: Prepare `users.txt` and `groups.txt`

- **users.txt**  
  Example:
  ```
  user1:John Doe:dev_team,admins:yes
  user2:Jane Smith:dev_team:no
  ```

- **groups.txt**  
  Example:
  ```
  dev_team:1001
  admins:1000
  ```

If `groups.txt` doesn't exist, the script will create default groups.

### Step 2: Make the script executable
Run the following command to give execute permission to the script:
```bash
chmod +x user_setup.sh
```

### Step 3: Run the script with `sudo` privileges
To execute the script, run:
```bash
sudo ./user_group_manager.sh
```

### Step 4: Review the logs
- **audit.log**: Contains a log of all actions performed by the script.
- **passwords.txt**: Contains the randomly generated passwords for users.

### Example Output in `audit.log`
```
2025-02-01 09:00:01 - Processing user: user1 (John Doe)
2025-02-01 09:00:02 - Deleted existing user: user1
2025-02-01 09:00:03 - Created user: user1 (John Doe) and set password (Stored in passwords.txt)
2025-02-01 09:00:04 - Auto-created missing group: dev_team (ID: 2345)
2025-02-01 09:00:05 - Added user user1 to group: dev_team
2025-02-01 09:00:06 - Granted sudo to: user1
2025-02-01 09:00:07 - Script execution completed.
```

## Notes
- The script will automatically create any missing groups and group IDs if they are not provided in `groups.txt`.
- If a user already exists, the script will delete the old user and recreate them with the new configuration.
- Passwords are stored in `passwords.txt` and should be handled securely.
